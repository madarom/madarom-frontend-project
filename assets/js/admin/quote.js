function initQuotes(){let e=[],t=1;const n=document.getElementById("quotesBody"),r=document.getElementById("filterDate"),a=document.getElementById("sortOrder"),s=document.getElementById("statusFilter"),o=document.getElementById("pagination"),c=e=>{if(n.innerHTML="",0===e.length)return n.innerHTML='<tr><td colspan="4" class="text-center py-6 text-gray-500">No quotes available.</td></tr>',void(o.innerHTML="");const r=3*(t-1),a=r+3;e.slice(r,a).forEach(e=>{let t=0;e.items.forEach(e=>{t+=e.price_snapshot*e.quantity}),n.innerHTML+=`\n          <tr class="hover:bg-gray-50">\n            <td class="px-6 py-4 text-sm font-medium">\n                <div class="flex items-center gap-3">\n                    <div class="w-12 h-12 flex justify-center items-center bg-gray-50 rounded-full">\n                    <i class="fas fa-file-pdf text-gray-400 text-2xl"></i>\n                    </div>\n                    <div class="flex flex-col">\n                    <span class="font-semibold text-gray-800">${e.quote_number||"N/A"}</span>\n                    <span class="text-gray-500 text-sm"><i class="bx bx-user mr-2 text-lg"></i> ${e.user.name}</span>\n                    </div>\n                </div>\n            </td>\n            <td class="px-6 py-4 text-lg font-semibold">${formatPrice(t)}</td>\n            <td class="px-6 py-4">${(e=>{const t="px-2 py-1 rounded-full text-xs font-medium";switch(e){case"validated":return`<span class="${t} bg-success/10 text-success">Validated</span>`;case"pending":return`<span class="${t} bg-warning/10 text-yellow-800">Pending</span>`;case"refused":return`<span class="${t} bg-danger/10 text-danger">Refused</span>`;default:return`<span class="${t} bg-gray-200 text-gray-600">${e}</span>`}})(e.status)}</td>\n            <td class="px-6 py-4">${e.created_at?.split("T")[0]}</td>\n            <td class="px-6 py-4 text-right">\n                <button onclick="viewQuote('${e.id}')" class="mt-4 flex items-center justify-center gap-2 btn-default text-sm px-4 py-2 rounded-full w-full">\n                    <i class="bx bx-show"></i> View details\n                </button>\n            </td>\n          </tr>\n        `}),function(e){const n=Math.ceil(e/3);if(o.innerHTML="",n<=1)return;const r=document.createElement("button");r.innerHTML="&laquo;",r.disabled=1===t,r.className="px-3 py-1 rounded-full "+(1===t?"border border-gray-300 text-gray-600 hover:bg-gray-100 cursor-not-allowed":"border border-gray-300 text-gray-600 hover:bg-gray-100"),r.onclick=()=>{t>1&&(t--,i())},o.appendChild(r);let a=1,s=n;n>10&&(t<=4?(a=1,s=5):t>=n-3?(a=n-4,s=n):(a=t-2,s=t+2));l(1),a>2&&d();for(let e=a;e<=s;e++)1!==e&&e!==n&&l(e);s<n-1&&d();n>1&&l(n);const c=document.createElement("button");function l(e){const n=document.createElement("button");n.innerText=e,n.className="px-4 py-1 rounded-full border "+(e===t?"bg-red text-white":"border-gray-300 text-gray-600 hover:bg-gray-100"),n.onclick=()=>{t=e,i()},o.appendChild(n)}function d(){const e=document.createElement("span");e.innerText="...",e.className="px-2 text-gray-500",o.appendChild(e)}c.innerHTML="&raquo;",c.disabled=t===n,c.className="px-3 py-1 rounded-full "+(t===n?"border border-gray-300 text-gray-600 hover:bg-gray-100 cursor-not-allowed":"border border-gray-300 text-gray-600 hover:bg-gray-100"),c.onclick=()=>{t<n&&(t++,i())},o.appendChild(c)}(e.length)};const i=()=>{let t=[...e];const n=r.value,o=a.value,i=s.value;n&&(t=t.filter(e=>e.created_at.startsWith(n))),i&&(t=t.filter(e=>e.status===i)),t.sort((e,t)=>{const n=new Date(e.created_at),r=new Date(t.created_at);return"desc"===o?r-n:n-r}),c(t)};window.fetchQuotes=async function(){const t=sessionStorage.getItem("token");if(t)try{const n=await fetch("https://madarom-project-production.up.railway.app/api/quote",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!n.ok){const e=await n.json().catch(()=>({})),t=e.message||e.error||"Fetch failed";throw new Error(t)}const r=await n.json();console.log("Les devis:",r),e=r.filter(e=>"pending"===e.status?.toLowerCase()),i()}catch(e){console.error("Error fetching quotes:",e),alert(`Error fetching quotes: ${e.message}`)}else alert("No token found. Please log in.")},window.viewQuote=function(e){e&&(window.location.href=`/admin/quote/show?ref=${encodeURIComponent(e)}`)},r.addEventListener("input",i),a.addEventListener("change",i),s.addEventListener("change",i),fetchQuotes()}function formatPrice(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}