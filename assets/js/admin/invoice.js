function initInvoices(){let e=[],t=1;const n=document.querySelector(".grid"),r=document.getElementById("filterDate"),o=document.getElementById("sortOrder"),a=document.getElementById("statusFilter"),s=document.getElementById("pagination"),c=e=>{n.innerHTML="";const r=6*(t-1),o=r+6;e.slice(r,o).forEach(e=>{let t=0;e.items.forEach(e=>{t+=e.price_snapshot*e.quantity});const r={pending:"bg-yellow-100 text-[#e6a534]",validated:"bg-green-100 text-[#68b56c]",command:"bg-blue-100 text-[#1f7ed1]",canceled:"bg-red-100 text-[#ab1a17]"}[e.quote.status.toLowerCase()]||"bg-gray-400";var o;n.innerHTML+=`\n          <div class="relative bg-white p-5 rounded-xl shadow-md">\n            <span class="absolute top-3 right-3 text-xs px-3 py-1 rounded-full ${r}">\n              ${e.quote.status}\n            </span>\n            <h2 class="text-lg font-medium text-gray-800">${e.quote.reference}</h2>\n            <p class="flex items-center text-gray-600 mt-2 text-sm">\n              <i class="bx bx-calendar mr-2 text-lg"></i> ${e.quote.updated_at?.split("T")[0]}\n            </p>\n            <p class="flex items-center text-gray-600 mt-1 text-sm">\n              <i class="bx bx-user mr-2 text-lg"></i> ${e.user.name}\n            </p>\n            <h3 class="text-xl font-medium text-gray-900 mt-3">${o=t,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(o)}</h3>\n            <button onclick="viewInvoice('${e.id}')" class="mt-4 flex items-center justify-center gap-2 btn-default text-sm px-4 py-2 rounded-full w-full">\n              <i class="bx bx-show"></i> View details\n            </button>\n          </div>\n        `}),function(e){const n=Math.ceil(e/6);if(s.innerHTML="",n<=1)return;const r=document.createElement("button");r.innerHTML="&laquo;",r.disabled=1===t,r.className="px-3 py-1 rounded-full "+(1===t?"border border-gray-300 text-gray-600 hover:bg-gray-100 cursor-not-allowed":"border border-gray-300 text-gray-600 hover:bg-gray-100"),r.onclick=()=>{t>1&&(t--,i())},s.appendChild(r);let o=1,a=n;n>10&&(t<=4?(o=1,a=5):t>=n-3?(o=n-4,a=n):(o=t-2,a=t+2));l(1),o>2&&d();for(let e=o;e<=a;e++)1!==e&&e!==n&&l(e);a<n-1&&d();n>1&&l(n);const c=document.createElement("button");function l(e){const n=document.createElement("button");n.innerText=e,n.className="px-4 py-1 rounded-full border "+(e===t?"bg-red text-white":"border-gray-300 text-gray-600 hover:bg-gray-100"),n.onclick=()=>{t=e,i()},s.appendChild(n)}function d(){const e=document.createElement("span");e.innerText="...",e.className="px-2 text-gray-500",s.appendChild(e)}c.innerHTML="&raquo;",c.disabled=t===n,c.className="px-3 py-1 rounded-full "+(t===n?"border border-gray-300 text-gray-600 hover:bg-gray-100 cursor-not-allowed":"border border-gray-300 text-gray-600 hover:bg-gray-100"),c.onclick=()=>{t<n&&(t++,i())},s.appendChild(c)}(e.length)};const i=()=>{let t=[...e];const n=r.value,s=a.value;n&&(t=t.filter(e=>e.quote.updated_at?.startsWith(n))),s&&(t=t.filter(e=>e.quote.status===s)),t.sort((e,t)=>{const n=new Date(e.quote.updated_at),r=new Date(t.quote.updated_at);return"desc"===o.value?r-n:n-r}),c(t)};window.viewInvoice=function(e){e&&(window.location.href=`/admin/invoice/show?ref=${encodeURIComponent(e)}`)},r.addEventListener("input",i),o.addEventListener("change",i),a.addEventListener("change",i),async function(){const t=sessionStorage.getItem("token");if(!t)return alert("No token found. Please log in.");try{const n=await fetch("https://madarom-project-production.up.railway.app/api/quote",{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!n.ok){const e=await n.json().catch(()=>({}));throw new Error(e.message||e.error||"Fetch failed")}const r=await n.json();e=r.filter(e=>e.quote&&"facturation"===e.quote.status?.toLowerCase()),[...new Set(e.map(e=>e.quote.status))].forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e.charAt(0).toUpperCase()+e.slice(1),a.appendChild(t)}),i()}catch(e){console.error("Error fetching orders:",e),alert(`Error fetching orders: ${e.message}`)}}()}