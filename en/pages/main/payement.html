<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Submit Payment Proof</title><script src="https://cdn.tailwindcss.com"></script><link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet"><link rel="stylesheet" href="../../assets/css/style.css"><link rel="icon" href="/assets/img/favicon.ico" type="image/x-icon"></head><body class="bg-white p-6 text-gray-800 text-font-family"><div class="flex justify-between items-center max-w-4xl mx-auto mb-6"><a href="/en/order"><button class="flex items-center gap-2 text-gray-600 hover:text-[#333333] transition font-semibold"><i class="bx bx-arrow-back text-xl"></i> <span>Back</span></button></a></div><div class="max-w-2xl mx-auto bg-white p-8 border border-gray-100"><h2 class="text-3xl font-bold mb-2 text-gray-800 text-center">Payment Proof</h2><p class="text-gray-500 text-center mb-6 text-sm">Submit your details to confirm your payment</p><form id="paymentForm" class="flex flex-col gap-5"><input type="hidden" name="quote_id" id="quote_id"><div><label for="phone_number" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label> <input type="text" name="phone_number" id="phone_number" required class="w-full border border-gray-300 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-red-800 transition"></div><div><label for="city" class="block text-sm font-medium text-gray-700 mb-1">City</label> <input type="text" name="city" id="city" required class="w-full border border-gray-300 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-red-800 transition"></div><div><label for="country" class="block text-sm font-medium text-gray-700 mb-1">Country</label> <input type="text" name="country" id="country" required class="w-full border border-gray-300 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-red-800 transition"></div><div><label for="screenshot" class="block text-sm font-medium text-gray-700 mb-1">Payment Screenshot*</label> <input type="file" name="screenshot" id="screenshot" accept="image/*" required class="w-full border border-gray-300 rounded-xl p-2 text-sm focus:outline-none focus:ring-2 focus:ring-red-800 transition"></div><div id="preview" class="mt-2 text-center"></div><button type="submit" class="w-full btn-primary text-white font-semibold py-3 rounded-xl shadow-lg transition-transform transform hover:scale-[1.02] active:scale-95">Submit Payment</button></form></div><script>const form=document.getElementById("paymentForm"),quote_id=document.getElementById("quote_id"),phone_number=document.getElementById("phone_number"),city=document.getElementById("city"),country=document.getElementById("country"),screenshot=document.getElementById("screenshot"),preview=document.getElementById("preview"),token=sessionStorage.getItem("token");async function fileToBase64(e){return new Promise((t,n)=>{const o=new FileReader;o.readAsDataURL(e),o.onload=()=>t(o.result.split(",")[1]),o.onerror=e=>n(e)})}async function loadQuoteData(e){try{const t=await fetch(`https://madarom-project-production.up.railway.app/api/quote/${e}`,{headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Devis non trouvÃ©");const n=await t.json();quote_id.value=n.id||n.quote?.id}catch(e){console.error(e),alert("Impossible de charger le devis.")}}screenshot.addEventListener("change",async()=>{if(screenshot.files&&screenshot.files[0]){const e=new FileReader;e.onload=e=>{preview.innerHTML=`<img src="${e.target.result}" class="mx-auto max-w-xs rounded-lg shadow-md mt-3"/>`},e.readAsDataURL(screenshot.files[0])}else preview.innerHTML=""}),form.addEventListener("submit",async e=>{if(e.preventDefault(),!token)return void alert("No token found. Please login first.");const t=form.querySelector("button[type=submit]");t.disabled=!0,t.innerHTML="Submitting...";try{const e=await fileToBase64(screenshot.files[0]),t={quote_id:quote_id.value,phone_number:phone_number.value,city:city.value,country:country.value,screenshot:e},n=await fetch("https://madarom-project-production.up.railway.app/api/quote/payment",{method:"POST",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(n.ok){const e=await n.json();alert(e.message),form.reset(),preview.innerHTML=""}else{const e=await n.json();console.error(e),alert(e.message||"Une erreur est survenue.")}}catch(e){console.error(e),alert("Une erreur est survenue lors de la soumission.")}finally{t.disabled=!1,t.innerHTML="Submit Payment"}});const params=new URLSearchParams(window.location.search),ref=params.get("ref");ref?loadQuoteData(ref):alert("Aucun ID de devis fourni.")</script></body></html>