<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Sign Up - Mad'arom</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet"><link rel="stylesheet" href="../../assets/css/authentification.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"><link rel="icon" href="/assets/img/favicon.ico" type="image/x-icon"></head><body class="min-h-screen flex items-center justify-center p-4"><div class="w-full max-w-md"><div class="items-center text-center mb-6"><h1 class="logo-font text-2xl text-[#56b6a8]">Mad'<span class="text-[#bc1414]">arom</span></h1></div><div class="bg-white rounded-lg p-8 sm:p-10 shadow"><form id="signupForm" novalidate><div id="step1"><div class="input-container"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 input-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"/></svg> <input type="email" id="email" name="email" required class="input-field" placeholder="Email" autocomplete="email"></div><p id="emailError" class="text-red-500 text-xs mb-4 hidden">Veuillez entrer un email valide.</p><div class="input-container"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 input-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg> <input type="password" id="password" name="password" required class="input-field" placeholder="Password" autocomplete="new-password"> <button type="button" class="toggle-password" aria-label="Afficher / Cacher mot de passe" tabindex="-1"><i class="fa-solid fa-eye"></i></button></div><ul class="text-xs text-gray-500 mb-4" id="passwordChecklist"><li id="length" class="flex items-center gap-2"><i class="fas fa-check icon text-red-500"></i> Minimum 8 characters</li><li id="uppercase" class="flex items-center gap-2"><i class="fas fa-check icon text-red-500"></i> At least one uppercase letter</li><li id="special" class="flex items-center gap-2"><i class="fas fa-check icon text-red-500"></i> At least one number and one special character</li></ul><button type="button" id="nextBtn" class="btn-primary rounded-full">Next</button></div><div id="step2" class="hidden"><div class="input-container"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 input-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg> <input type="password" id="confirmPassword" name="confirmPassword" required class="input-field" placeholder="Confirm Password" autocomplete="new-password"> <button type="button" class="toggle-password" aria-label="Afficher / Cacher mot de passe" tabindex="-1"><i class="fa-solid fa-eye"></i></button></div><p id="confirmError" class="text-red-500 text-xs mb-4 hidden">Passwords do not match.</p><button type="submit" class="btn-primary rounded-full">Sign up</button></div></form><div class="mt-8 text-center"><p class="text-gray-500">Already have an account? <a href="/signin" class="text-[#56b6a8] font-medium">Log in</a></p></div></div></div><script type="module">import{getLastUrl,clearLastUrl}from"../../assets/js/url.js";const API_URL_REG="https://madarom-project-production.up.railway.app/api/register",email=document.getElementById("email"),password=document.getElementById("password"),confirmPassword=document.getElementById("confirmPassword"),emailError=document.getElementById("emailError"),confirmError=document.getElementById("confirmError"),checklist={length:document.getElementById("length"),uppercase:document.getElementById("uppercase"),special:document.getElementById("special")},step1=document.getElementById("step1"),step2=document.getElementById("step2"),nextBtn=document.getElementById("nextBtn"),form=document.getElementById("signupForm"),emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;function updateIcon(e,t){const r=e.querySelector(".icon");r.classList.remove("text-green-500","text-red-500"),r.classList.add(t?"text-green-500":"text-red-500")}function validatePasswordChecklist(){const e=password.value;updateIcon(checklist.length,e.length>=8),updateIcon(checklist.uppercase,/[A-Z]/.test(e)),updateIcon(checklist.special,/[\d\W]/.test(e))}function checkPasswordMatch(){return""!==confirmPassword.value&&password.value!==confirmPassword.value?(confirmError.classList.remove("hidden"),!1):(confirmError.classList.add("hidden"),!0)}document.querySelectorAll(".toggle-password").forEach(e=>{e.addEventListener("click",()=>{const t=e.previousElementSibling;"password"===t.type?(t.type="text",e.innerHTML='<i class="fa-solid fa-eye-slash"></i>'):(t.type="password",e.innerHTML='<i class="fa-solid fa-eye"></i>')})}),password.addEventListener("input",validatePasswordChecklist),nextBtn.addEventListener("click",()=>{let e=!0;emailRegex.test(email.value)?emailError.classList.add("hidden"):(emailError.classList.remove("hidden"),e=!1);password.value.length>=8&&/[A-Z]/.test(password.value)&&/[\d\W]/.test(password.value)||(e=!1),e&&(step1.classList.add("hidden"),step2.classList.remove("hidden"))}),form.addEventListener("submit",async e=>{if(e.preventDefault(),!checkPasswordMatch())return;const t=form.querySelector("button[type=submit]");t.disabled=!0,t.innerHTML="Inscription...";const r={name:email.value.split("@")[0],email:email.value.trim(),password:password.value,password_confirmation:confirmPassword.value};try{const e=await fetch(API_URL_REG,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(r)}),s=await e.json();if(t.disabled=!1,t.innerHTML="S’inscrire",!e.ok)return void(s.errors&&(s.errors.email&&(emailError.textContent=s.errors.email[0],emailError.classList.remove("hidden")),s.errors.password&&(confirmError.textContent=s.errors.password[0],confirmError.classList.remove("hidden"))));if(s.user){if(sessionStorage.setItem("token",s.token),"admin"===s.user.role)location.assign("/admin/dashboard");else{const e=localStorage.getItem("cart"),t=sessionStorage.getItem("token");if(e){const r=JSON.parse(e);console.log("Mety 1");for(const e of r)try{const r=await fetch("https://madarom-project-production.up.railway.app/api/cart",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({product_id:e.product_id||e.product.id,quantity:e.quantity})});if(!r.ok){const e=await r.json();return console.error("Erreur API ajout panier:",e),void alert("Erreur lors de l'ajout au panier : "+(e.message||"Erreur inconnue"))}}catch(e){return console.error("Erreur réseau:",e),void alert("Erreur réseau lors de l'ajout au panier.")}console.log("Mety 2"),localStorage.removeItem("cart")}const r=getLastUrl();if(clearLastUrl(),r)window.location.href=r;else{const e=sessionStorage.getItem("lang")?.toLowerCase()||"fr";window.location.href=`${window.location.origin}/${e}/`}}form.reset(),step2.classList.add("hidden"),step1.classList.remove("hidden")}}catch(e){console.error(e),alert("Erreur de connexion."),t.disabled=!1,t.innerHTML="S’inscrire"}})</script></body></html>