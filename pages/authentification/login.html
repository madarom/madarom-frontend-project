<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Login - Mad'arom</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"><link rel="stylesheet" href="../../assets/css/authentification.css"><link rel="icon" href="/assets/img/favicon.ico" type="image/x-icon"></head><body class="min-h-screen flex items-center justify-center p-4 bg-[#fcffff]"><div class="w-full max-w-md"><div class="items-center text-center mb-6"><h1 class="logo-font text-2xl text-[#56b6a8]">Mad'<span class="text-[#bc1414]">arom</span></h1></div><div class="bg-white rounded-lg p-8 sm:p-10 shadow"><form id="loginForm" novalidate><div class="input-container mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 input-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"/></svg> <input type="email" id="username" required class="input-field" placeholder="Email" autocomplete="username"></div><div class="input-container mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 input-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg> <input type="password" id="password" required class="input-field" placeholder="Password" autocomplete="current-password"> <button type="button" class="toggle-password" aria-label="Afficher / Cacher mot de passe" tabindex="-1"><i class="fa-solid fa-eye"></i></button></div><button type="submit" class="btn-primary rounded-full w-full">Log in</button></form><div class="mt-8 text-center"><p class="text-gray-500">Not registered yet? <a href="/signup" data-link class="text-[#56b6a8] font-medium">Sign up</a></p></div></div></div><script type="module">import{getLastUrl,clearLastUrl}from"../../assets/js/url.js";const API_URL_LOG="https://madarom-project-production.up.railway.app/api/login",form=document.getElementById("loginForm"),email=document.getElementById("username"),password=document.getElementById("password");form.addEventListener("submit",async e=>{e.preventDefault();const t=form.querySelector("button[type=submit]");t.disabled=!0,t.innerHTML="Connexion...";const r={email:email.value.trim(),password:password.value.trim()};try{const e=await fetch(API_URL_LOG,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(e.ok){const t=await e.json();if(sessionStorage.setItem("token",t.token),"admin"===t.user.role)location.assign("/admin/dashboard");else{const e=localStorage.getItem("cart"),t=sessionStorage.getItem("token");if(e){const r=JSON.parse(e);for(const e of r)try{const r=await fetch("https://madarom-project-production.up.railway.app/api/cart",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({product_id:e.product_id||e.product.id,quantity:e.quantity})});if(!r.ok){const e=await r.json();return console.error("Erreur API ajout panier:",e),void alert("Erreur lors de l'ajout au panier : "+(e.message||"Erreur inconnue"))}}catch(e){return console.error("Erreur réseau:",e),void alert("Erreur réseau lors de l'ajout au panier.")}localStorage.removeItem("cart")}const r=getLastUrl();if(clearLastUrl(),r)window.location.href=r;else{const e=sessionStorage.getItem("lang")?.toLowerCase()||"fr";window.location.href=`${window.location.origin}/${e}/`}}}else{const t=await e.json();alert(t.message||"Identifiants incorrects.")}}catch(e){console.error("Erreur :",e),alert("Une erreur est survenue.")}finally{t.disabled=!1,t.innerHTML="Se connecter"}}),document.querySelector(".toggle-password").addEventListener("click",()=>{"password"===password.type?(password.type="text",document.querySelector(".toggle-password i").classList.replace("fa-eye","fa-eye-slash")):(password.type="password",document.querySelector(".toggle-password i").classList.replace("fa-eye-slash","fa-eye"))})</script></body></html>