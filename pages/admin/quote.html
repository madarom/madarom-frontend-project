<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>User Quotes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../../assets/css/style.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#AB1A17',
            secondary: '#AAC2AE',
            success: '#65A67A',
            warning: '#F4D35E',
            danger: '#E63946',
            background: '#FCFFFC',
            text: '#2F2F2F'
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gray-100 p-6">

  <div class="flex items-center justify-between mb-10">
    <h1 class="text-4xl font-bold text-primary flex items-center gap-2">
      <i class="fas fa-file-invoice text-primary"></i>
      Quotes
    </h1>
    <button onclick="fetchQuotes()" 
      class="bg-secondary text-text px-4 py-2 rounded-full shadow hover:scale-105 transition-transform flex items-center justify-center">
      <i class="fas fa-sync-alt text-lg"></i>
    </button>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 bg-[#2a2a2a] p-6 rounded-sm shadow-lg border border-gray-700">
  
    <div class="flex flex-col w-full">
      <label for="filterDate" class="block mb-2 text-sm font-medium text-gray-400">Date</label>
      <input 
        type="date" 
        id="filterDate" 
        class="w-full px-4 py-2 rounded-xl bg-[#1f1f1f] border border-gray-600 text-gray-200 
              focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
      />
    </div>

    <div class="flex flex-col w-full">
      <label for="statusFilter" class="text-sm text-gray-400 mb-2">Filter by Status</label>
      <select 
        id="statusFilter" 
        class="w-full px-4 py-2 rounded-xl bg-[#1f1f1f] border border-gray-600 text-gray-200 
              focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
      >
        <option value="">All Status</option>
      </select>
    </div>
    
    <div class="flex flex-col w-full">
      <label for="sortOrder" class="text-sm text-gray-400 mb-2">Sort Order</label>
      <select 
        id="sortOrder" 
        class="w-full px-4 py-2 rounded-xl bg-[#1f1f1f] border border-gray-600 text-gray-200 
              focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
      >
        <option value="asc">Sort Ascending</option>
        <option value="desc">Sort Descending</option>
      </select>
    </div>
  </div>

  <div class="bg-white rounded-2xl shadow overflow-hidden">
    <table class="w-full text-left">
      <tbody id="quotesBody" class="divide-y divide-gray-100 bg-white text-sm">

      </tbody>
    </table>
  </div>
  
  <div id="pagination" class="fixed bottom-4 left-0 right-0 flex justify-center items-center gap-2"></div>

  <!-- <script>
    let allQuotes = [];

    const tbody = document.getElementById('quotesBody');
    const filterDate = document.getElementById('filterDate');
    const sortOrder = document.getElementById('sortOrder');
    const statusFilter = document.getElementById('statusFilter');

    const renderStatusBadge = (status) => {
      const base = "px-2 py-1 rounded-full text-xs font-medium";
      switch (status) {
        case "validated":
          return `<span class="${base} bg-success/10 text-success">Validated</span>`;
        case "pending":
          return `<span class="${base} bg-warning/10 text-yellow-800">Pending</span>`;
        case "refused":
          return `<span class="${base} bg-danger/10 text-danger">Refused</span>`;
        default:
          return `<span class="${base} bg-gray-200 text-gray-600">${status}</span>`;
      }
    }

    const renderQuotes = (data) => {
      tbody.innerHTML = '';
      if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4" class="text-center py-6 text-gray-500">No quotes available.</td></tr>`;
        return;
      }

      data.forEach(q => {
        tbody.innerHTML += `
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 font-medium">${q.quote_number || 'N/A'}</td>
            <td class="px-6 py-4">${renderStatusBadge(q.status)}</td>
            <td class="px-6 py-4">${q.created_at?.split('T')[0]}</td>
            <td class="px-6 py-4 text-right">
              <button onclick="viewQuote('${q.id}')" class="bg-primary text-white text-sm px-3 py-1.5 rounded-lg hover:bg-[#8c1514]">View</button>
            </td>
          </tr>
        `;
      });
    }

    const applyFilters = () => {
      let filtered = [...allQuotes];
      const dateVal = filterDate.value;
      const sort = sortOrder.value;
      const statusVal = statusFilter.value;

      if (dateVal) filtered = filtered.filter(q => q.created_at.startsWith(dateVal));
      if (statusVal) filtered = filtered.filter(q => q.status === statusVal);

      filtered.sort((a, b) => {
        const dA = new Date(a.created_at);
        const dB = new Date(b.created_at);
        return sort === 'desc' ? dB - dA : dA - dB;
      });

      renderQuotes(filtered);
    }

    async function fetchQuotes() {
      const token = sessionStorage.getItem("token");
      if (!token) {
        alert("No token found. Please log in.");
        return;
      }

      try {
        const res = await fetch("https://madarom-project-production.up.railway.app/api/quote", {
          method: "GET",
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        });

        if (!res.ok) {
          const errorData = await res.json().catch(() => ({}));
          const message = errorData.message || errorData.error || "Fetch failed";
          throw new Error(message);
        }

        const data = await res.json();
        console.log("Les devis:", data);

        allQuotes = data.filter(quote => quote.status?.toLowerCase() === "pending");

        applyFilters();
      } catch (err) {
        console.error("Error fetching quotes:", err);
        alert(`Error fetching quotes: ${err.message}`);
      }
    }

    function viewQuote(id) {
      if (!id) return;
      window.location.href = `/admin/quote/show?ref=${encodeURIComponent(id)}`;
    }

    filterDate.addEventListener('input', applyFilters);
    sortOrder.addEventListener('change', applyFilters);
    statusFilter.addEventListener('change', applyFilters);

    fetchQuotes();
  </script> -->
</body>
</html>