<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Quote</title><script src="https://cdn.tailwindcss.com"></script><link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet"><link rel="stylesheet" href="../../assets/css/style.css"><link rel="icon" href="/assets/img/favicon.ico" type="image/x-icon"></head><body class="bg-white p-6 text-gray-800 text-font-family"><div class="flex justify-between items-center max-w-4xl mx-auto mb-6"><a href="javascript:history.back()"><button class="flex items-center gap-2 text-gray-600 hover:text-[#333333] transition font-semibold"><i class="bx bx-arrow-back text-xl"></i> <span>Back</span></button></a><div class="flex gap-2"><button onclick="generatePDF()" class="flex items-center gap-2 btn-primary text-white px-4 py-2 rounded-full transition"><i class="bx bx-download text-xl"></i> <span>Download PDF</span></button></div></div><div class="max-w-6xl mx-auto flex gap-6"><div id="devis" class="flex-1 max-w-4xl mx-auto bg-white p-8 border border-gray-100"><div class="flex justify-between items-center border-b pb-6 mb-6"><div class="flex flex-col gap-2"><img src="../../assets/img/logo.jpg" alt="Mad'arom logo" class="w-32 h-auto mb-2"><h1 class="text-3xl font-extrabold text-[#333333] tracking-wide">INVOICE</h1><p class="text-sm text-gray-500" id="order-date"></p><p class="text-sm text-gray-500" id="quote-number">#QTE-XXXXXX</p></div><div class="text-right"><h2 class="font-semibold text-lg logo-font">Mad'arom</h2><p class="text-sm text-gray-600">Lot 73 AD Ankadikely Ilafy</p><p class="text-sm text-gray-600">+261 34 45 999 60</p><p class="text-sm text-gray-600">contact@madarom.net</p></div></div><div class="mb-6 bg-gray-50 p-4 border"><h3 class="font-medium mb-2 text-gray-700 text-lg" id="client-name">Name</h3><p class="text-sm text-gray-500" id="client-email">Email</p><p class="text-sm text-gray-500" id="client-phone"></p><p class="text-sm text-gray-500" id="client-address"></p></div><div class="overflow-x-auto border border-gray-200"><table class="w-full text-sm"><thead><tr class="bg-gray-50 text-[#333333] text-left"><th class="py-3 px-4 font-medium">Product</th><th class="py-3 px-4 text-center font-medium">Quantity</th><th class="py-3 px-4 text-right font-medium">Unit Price</th><th class="py-3 px-4 text-right font-medium">Total</th></tr></thead><tbody id="quotes-items" class="divide-y divide-gray-100"></tbody></table></div><div class="mt-6 flex justify-end"><div class="w-full md:w-1/2 bg-gray-50 p-4 border space-y-2"><div class="flex justify-between"><span class="font-medium">Sub-total:</span> <span id="subtotal">0 USD</span></div><div class="flex justify-between text-lg font-semibold text-[#333333]"><span>Total :</span> <span id="total">0 USD</span></div></div></div><div class="mt-8 text-xs text-gray-500 text-left"><p id="delivery-date"></p><p class="mt-1">Thank you for your trust!</p></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script><script>function generatePDF(){const e=document.getElementById("devis"),t={margin:.5,filename:`invoice_${document.getElementById("quote-number").textContent.replace(/\D/g,"")}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"in",format:"a4",orientation:"portrait"}};html2pdf().set(t).from(e).save()}function formatPrice(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}const token=sessionStorage.getItem("token");token||console.warn("Aucun token trouvé dans sessionStorage");let currentQuoteId=null;async function loadQuoteData(e){try{const t=await fetch(`https://madarom-project-production.up.railway.app/api/quote/${e}`,{headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("Devis non trouvé");const n=await t.json();currentQuoteId=n.quote.id,document.getElementById("order-date").textContent=`Date: ${n.quote.updated_at.split("T")[0]}`,document.getElementById("quote-number").textContent=`N° ${n.quote.reference}`,document.getElementById("client-name").textContent=n.user.name,document.getElementById("client-email").textContent=n.user.email,n.quote.payment&&(document.getElementById("client-phone").textContent=n.quote.payment.phone_number||"N/A",document.getElementById("client-address").textContent=`${n.quote.payment.city}, ${n.quote.payment.country}`);const o=document.getElementById("quotes-items");o.innerHTML="";let r=0;n.items.forEach(e=>{const t=e.price_snapshot*e.quantity;r+=t,o.innerHTML+=`\n            <tr>\n              <td class="py-2 px-2">${e.product.name_en}</td>\n              <td class="py-2 px-2 text-center">${e.quantity}</td>\n              <td class="py-2 px-2 text-right">${formatPrice(e.price_snapshot)}</td>\n              <td class="py-2 px-2 text-right">${formatPrice(t)}</td>\n            </tr>`});const a=r;document.getElementById("subtotal").textContent=formatPrice(r),document.getElementById("total").textContent=formatPrice(a);let i=new Date(n.quote.updated_at);i=new Date(i.getFullYear(),i.getMonth(),i.getDate());let s=n.quote.day||0,c=n.quote.hours||0;(!s||0===s)&&c>0&&(s=Math.floor(c/24),c%=24);let u=new Date(i);u.setDate(u.getDate()+s),u.setHours(u.getHours()+c);let d="This order is delivered in ";s>0&&(d+=`${s} day${s>1?"s":""}`),s>0&&c>0&&(d+=" and "),c>0&&(d+=`${c} hour${c>1?"s":""}`);d+=` , on ${u.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}`,document.getElementById("delivery-date").textContent=d,"command"===n.quote.status.toLowerCase()&&invoiceBtn.classList.remove("hidden")}catch(e){console.error("Erreur lors du chargement du devis :",e),alert("Impossible de charger le devis.")}}const params=new URLSearchParams(window.location.search),ref=params.get("ref");ref?(console.log("ID du devis :",ref),loadQuoteData(ref)):alert("Aucun ID de devis fourni.")</script></body></html>